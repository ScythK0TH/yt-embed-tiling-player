<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Universal Floating Player</title>
  <style>
    :root{
      --accent:#ff3b3b;
      --bg:#0b0b0f;
      --panel:#111217;
      --glass: rgba(255,255,255,0.03);
      --text:#e6e6e9;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}

    /* The video fills the viewport */
    .player-wrap{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;z-index:1;overflow:hidden;
    }
    .player-wrap iframe{
      width:100vw;height:100vh;border:0;display:block;
    }

    /* Floating input panel WRAPPER */
    .float-wrap{
      position:fixed;left:0;width:100%;bottom:0;
      z-index:5;
      display:flex; justify-content:center; align-items:flex-end;
      padding-bottom: 30px;
      pointer-events:none;
    }

    /* The Panel itself */
    .float-panel{
      display:flex;align-items:center;gap:10px;padding:10px 14px;
      border-radius:999px;
      background:linear-gradient(180deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
      backdrop-filter:blur(10px);
      box-shadow:0 6px 24px rgba(0,0,0,0.5);
      border:1px solid rgba(255,255,255,0.08);
      
      max-width:520px;min-width:44px;
      pointer-events:auto;
      
      /* Smooth Transition */
      transform: translateY(0) scale(1);
      opacity: 1;
      transition: 
        min-width 400ms cubic-bezier(0.2, 0.8, 0.2, 1),
        padding 400ms ease,
        transform 500ms cubic-bezier(0.34, 1.56, 0.64, 1),
        opacity 400ms ease,
        border-radius 400ms ease;
      
      overflow:hidden;
    }

    /* COLLAPSED STATE */
    .float-panel.collapsed{
      min-width:44px;
      padding:8px;
      border-radius:50%;
      cursor:pointer;
      
      transform: translateY(120%) scale(0.9);
      opacity: 0.4;
      box-shadow: none;
    }
    
    .float-panel.collapsed:hover {
      opacity: 0.8;
      transform: translateY(110%) scale(1);
    }

    .float-panel input{
      border:0;outline:0;background:transparent;color:var(--text);font-size:14px;width:420px;max-width:calc(100vw - 160px);
      transition: opacity 200ms ease;
    }
    .float-panel.collapsed input{width:0;padding:0;margin:0;opacity:0}

    .hint{
      font-size:13px;opacity:0.75;white-space:nowrap;max-width:220px;overflow:hidden;text-overflow:ellipsis;
    }

    .icon{
      width:28px;height:28px;display:inline-grid;place-items:center;border-radius:50%;
      background:var(--glass);border:1px solid rgba(255,255,255,0.05);
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .icon:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.3);
    }
    .icon:active {
      transform: scale(0.95);
    }

    .btn{cursor:pointer;border:0;background:transparent;color:var(--text);font-weight:600}

    .help{
      position:fixed;left:50%;transform:translateX(-50%);bottom:90px;background:var(--panel);padding:8px 12px;border-radius:8px;font-size:13px;color:rgba(230,230,233,0.9);box-shadow:0 6px 18px rgba(2,6,23,0.6);z-index:4;display:none;
      pointer-events: none;
    }
    .help.show{display:block; animation: fadeIn 0.3s ease;}

    @keyframes fadeIn { from{opacity:0; transform: translate(-50%, 10px);} to{opacity:1; transform: translate(-50%, 0);} }

    @media (max-width:560px){
      .float-panel{max-width:92vw}
      .float-panel input{max-width:calc(92vw - 120px)}
      .help{bottom:90px}
    }

    .float-panel:focus-within{box-shadow:0 10px 30px rgba(0,0,0,0.8); border-color: rgba(255,255,255,0.2);}

    .empty-msg{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:2;pointer-events:none}
    .empty-msg .card{background:linear-gradient(180deg,#0f1720,#09090c);padding:18px 22px;border-radius:12px;color:rgba(230,230,233,0.9);box-shadow:0 10px 30px rgba(0,0,0,0.7);pointer-events:auto; text-align:center; max-width: 300px;}

  </style>
</head>
<body>

  <div class="player-wrap" id="playerWrap">
    <div style="color:#666;position:absolute;left:12px;top:12px;font-size:13px;">Waiting for video...</div>
  </div>

  <div class="empty-msg" id="emptyMsg">
    <div class="card">Paste YouTube link <b>OR</b> &lt;iframe&gt; embed code below.</div>
  </div>

  <div class="float-wrap" id="floatWrap">
    <div class="float-panel collapsed" id="floatPanel" title="Paste link or embed code">
      <div class="icon" id="toggleIcon" title="Click to Play">▶</div>
      
      <input id="ytInput" type="text" placeholder="Paste YouTube URL or Embed Code..." aria-label="Input" />
      <div class="hint" id="hint">Paste Link or &lt;iframe&gt; code</div>
      <button class="btn" id="clearBtn" title="Clear input" aria-label="Clear input" style="display:none">✖</button>
    </div>
  </div>

  <div class="help" id="help">Supports: YouTube Links, SharePoint Embeds, Generic &lt;iframe&gt;</div>

  <script>
    (function(){
      const panel = document.getElementById('floatPanel');
      const input = document.getElementById('ytInput');
      const icon = document.getElementById('toggleIcon');
      const hint = document.getElementById('hint');
      const clearBtn = document.getElementById('clearBtn');
      const help = document.getElementById('help');
      const playerWrap = document.getElementById('playerWrap');
      const emptyMsg = document.getElementById('emptyMsg');
      const floatWrap = document.getElementById('floatWrap');

      let hideTimeout = null;

      function expand(reason){
        panel.classList.remove('collapsed');
        panel.setAttribute('aria-expanded','true');
        if(reason === 'focus') help.classList.add('show');
        clearTimeout(hideTimeout);
      }
      
      function collapse(){
        if(document.activeElement === input) return;
        if(input.value && input.value.trim() !== '') return;
        
        panel.classList.add('collapsed');
        panel.setAttribute('aria-expanded','false');
        help.classList.remove('show');
      }

      function scheduleAutoHide(){
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(()=>{ collapse(); }, 2000);
      }

      // --- Logic: Parse Input ---
      function parseInput(val){
        if(!val) return null;

        // 1. Try to match YouTube ID specifically (Best Experience)
        try {
            let ytId = null;
            const u = new URL(val); // Check if it's a valid URL first
            if(u.hostname.includes('youtu.be')) ytId = u.pathname.slice(1).split(/[?&]/)[0];
            else if(u.hostname.includes('youtube.com')){
                const v = u.searchParams.get('v');
                if(v) ytId = v;
                else {
                    const m = u.pathname.match(/embed\/(.{11})/);
                    if(m) ytId = m[1];
                }
            }
            if(ytId) return { type: 'youtube', src: ytId };
        } catch(e) { 
            // Not a URL or not a simple URL, proceed to iframe check
        }

        // 2. Check if it is an <iframe ...> HTML string
        if(val.trim().toLowerCase().startsWith('<iframe')){
            const parser = new DOMParser();
            const doc = parser.parseFromString(val, 'text/html');
            const iframe = doc.querySelector('iframe');
            if(iframe && iframe.src) {
                return { type: 'iframe', src: iframe.src };
            }
        }

        // 3. Fallback: Assume it is a direct URL to a video source/embed
        // Just validate it looks like a URL
        try {
            new URL(val);
            return { type: 'iframe', src: val };
        } catch(e) {
            return null; // Invalid input
        }
      }

      function loadPlayer(data){
        playerWrap.innerHTML = '';
        emptyMsg.style.display = 'none';
        
        const iframe = document.createElement('iframe');
        
        if(data.type === 'youtube'){
             iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(data.src)}?rel=0&modestbranding=1&playsinline=1&autoplay=1`;
        } else {
            // Generic Iframe (SharePoint, etc.)
            iframe.src = data.src;
        }

        // Common Attributes
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen';
        iframe.allowFullscreen = true;
        iframe.setAttribute('webkitallowfullscreen', '');
        iframe.setAttribute('mozallowfullscreen', '');
        
        playerWrap.appendChild(iframe);
      }

      // *** Main Submit Logic ***
      function submitVideo() {
        const val = input.value.trim();
        if(!val) { input.focus(); return; }
        
        const result = parseInput(val);
        
        if(result){
          loadPlayer(result);
          input.blur(); 
        } else {
          const originalHint = hint.textContent;
          hint.textContent = '❌ Invalid Link or Code';
          hint.style.color = '#ff4b4b';
          setTimeout(()=>{
            hint.textContent = originalHint;
            hint.style.color = '';
          }, 2000);
        }
      }

      // --- Event Listeners ---
      floatWrap.addEventListener('mouseenter', ()=>{ if(panel.classList.contains('collapsed')) expand('hover'); });
      floatWrap.addEventListener('mouseleave', ()=>{ scheduleAutoHide(); });

      icon.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(panel.classList.contains('collapsed')){ expand('click'); input.focus(); } 
        else { submitVideo(); }
      });

      panel.addEventListener('click', (e)=>{
        if(panel.classList.contains('collapsed')){ expand('click'); input.focus(); }
      });

      input.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){ e.preventDefault(); submitVideo(); }
      });
      
      input.addEventListener('focus', ()=>{ expand('focus'); });
      input.addEventListener('blur', ()=>{ scheduleAutoHide(); });
      input.addEventListener('input', ()=>{
        clearBtn.style.display = input.value.trim() ? 'inline-block' : 'none';
      });
      clearBtn.addEventListener('click', ()=>{ input.value=''; clearBtn.style.display='none'; input.focus(); });

      document.addEventListener('click', (e)=>{
        if(!panel.contains(e.target) && !floatWrap.contains(e.target)) scheduleAutoHide();
      });
      
      // Force Hide on Escape
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape'){ 
          input.blur(); 
          panel.classList.add('collapsed');
          panel.setAttribute('aria-expanded','false');
          help.classList.remove('show');
        }
      });

    })();
  </script>
</body>
</html>